#$ -cwd
#$ -q sandbox
#$ -pe mpi 16
#$ -S /bin/bash

module load Bowtie2/v2.3.4.3
module load samtools/v1.10

REF=../infiles/Provisional_transcriptome.fasta
SAMPLE=${PWD##*/}
MATE1=$(ls ../../../00_data/Trimmed/${SAMPLE}/*_R1_*.QC.fastq.gz)
MATE2=$(ls ../../../00_data/Trimmed/${SAMPLE}/*_R2_*.QC.fastq.gz)
NAME=${SAMPLE}_provisional_transcriptome

bowtie2 -p $NSLOTS --no-unal -x ${REF} -1 ${MATE1} -2 ${MATE2} -S ${NAME}.sam

################################
# SALMON EXPECTS UNSORTED BAMS!
################################

samtools view -@ $NSLOTS -b -o ${NAME}.bam ${NAME}.sam
rm ${NAME}.sam




#samtools sort -@ $NSLOTS -o ${NAME}_sorted.bam ${NAME}.bam
#rm ${NAME}.bam
#samtools index ${NAME}_sorted.bam ${NAME}_sorted.bai
